<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreeView Alpine.js Component - Examples & Documentation</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="TreeView.js?v=1.0.10"></script>
    <link rel="stylesheet" href="TreeView.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .code-block {
            background: #1a1a1a;
            color: #fff;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }
        
        /* Add depth indicator styles */
        .depth-indicator {
            display: inline-block;
            font-size: 0.7em;
            padding: 0.1em 0.4em;
            margin-left: 0.5em;
            border-radius: 3px;
            background-color: #e2e8f0;
            color: #64748b;
        }
        
        .tree-node.beyond-max-depth {
            opacity: 0.7;
            border-left: 2px solid #ef4444;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-6">
    <div class="max-w-7xl mx-auto" x-data="{ activeTab: 'basic' }">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">TreeView Alpine.js Component</h1>
            <p class="text-gray-600 text-lg">A powerful, flexible, and easy-to-use tree view component</p>
        </header>

        <!-- Quick Start -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Quick Start</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-2">1. Include Required Files</h3>
                    <div class="code-block text-sm mb-4">
&lt;script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js">&lt;/script>
&lt;script src="TreeView.js">&lt;/script>
&lt;link rel="stylesheet" href="TreeView.css"></div>

                    <h3 class="text-lg font-semibold mb-2">2. Basic Implementation</h3>
                    <div class="code-block text-sm">
&lt;div x-data="TreeView({
    data: [
        {
            id: 'node-1',
            name: 'Root Node',
            children: [
                { id: 'node-2', name: 'Child Node', children: [] }
            ]
        }
    ],
    maxVisibleDepth: 4
})">&lt;/div></div>
                </div>
                
                <div class="border rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4">Live Demo</h3>
                    <!-- Basic Example - Using the component pattern for more reliable updates -->
                    <div x-data="TreeView({
                        data: [
                            {
                                id: 'demo-1',
                                name: 'My First Tree',
                                expanded: true,
                                children: [
                                    { id: 'demo-2', name: 'Getting Started', children: [] },
                                    { id: 'demo-3', name: 'Basic Usage', children: [] }
                                ]
                            }
                        ],
                        maxVisibleDepth: 4
                    })" x-id="['tree-demo']">
                        <!-- Search input -->
                        <div class="search-container mb-4">
                            <span class="search-icon">üîç</span>
                            <input type="text" 
                                   x-model="searchQuery" 
                                   placeholder="Search nodes..."
                                   class="search-input focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" />
                        </div>
                        
                        <div class="mb-4 flex items-center">
                            <span class="mr-2 text-gray-700">Max Visible Depth: </span>
                            <span class="font-mono bg-gray-100 px-2 py-1 rounded">4</span>
                            <span class="ml-4 text-sm text-gray-600">(Deeper nodes will still be added but visually styled differently)</span>
                        </div>
                        
                        <!-- Add New Node button -->
                        <div class="mb-4 flex justify-between items-center">
                            <button 
                                @click="showNodeModal = true; editingNodeId = null; nodeForm = { name: '', parentId: '' }" 
                                class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Add Node
                            </button>
                        </div>
                        
                        <!-- Node Add/Edit Modal -->
                        <div x-show="showNodeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full" @click.outside="showNodeModal = false">
                                <h3 class="text-xl font-semibold mb-4" x-text="editingNodeId ? 'Edit Node' : 'Add New Node'"></h3>
                                <form @submit.prevent="saveNode">
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nodeName">
                                            Node Name
                                        </label>
                                        <input 
                                            id="nodeName" 
                                            type="text" 
                                            x-model="nodeForm.name" 
                                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            required
                                        >
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nodeParent">
                                            Parent (leave empty for root level)
                                        </label>
                                        <select 
                                            id="nodeParent" 
                                            x-model="nodeForm.parentId" 
                                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                        >
                                            <option value="">Root Level</option>
                                            <template x-for="node in flattenedNodes" :key="node.id">
                                                <option 
                                                    :value="node.id" 
                                                    x-text="'‚Ä¢ '.repeat(node.level) + node.name + (node.level >= getMaxVisibleDepth() ? ' (Beyond visible depth)' : '')"
                                                    :selected="nodeForm.parentId === node.id"
                                                    :class="{'text-red-500': node.level >= getMaxVisibleDepth()}"
                                                ></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div class="flex justify-end space-x-2">
                                        <button 
                                            type="button" 
                                            @click="showNodeModal = false" 
                                            class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            type="submit" 
                                            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                        >
                                            Save
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Tree container with :key to force re-render -->
                        <div class="min-h-[200px]">
                            <div class="relative tree-container" :key="jsonOutput">
                                <!-- Use template for root nodes -->
                                <template x-for="(node, index) in treeData" :key="node.id + '-' + index">
                                    <div>
                                        <!-- Drop indicator above node -->
                                        <template x-if="dropTargetIndex === index && dropTargetParent === null && dropPosition === 'before'">
                                            <div class="drop-indicator"></div>
                                        </template>
                                        
                                        <!-- Node -->
                                        <div :id="'node-' + node.id"
                                             :class="{
                                                'tree-node': true, 
                                                'active': selectedNode === node.id,
                                                'search-match': nodeMatchesSearch(node),
                                                'dragover': dropPosition === 'inside' && dropTargetParent === node.id,
                                                'dragover-before': dropPosition === 'before' && dropTargetIndex === index && dropTargetParent === null,
                                                'dragover-after': dropPosition === 'after' && dropTargetIndex === index && dropTargetParent === null,
                                                'beyond-max-depth': !isNodeVisible(node)
                                             }"
                                             @click.stop="selectNode(node.id)"
                                             draggable="true"
                                             @dragstart="dragStart($event, node.id)"
                                             @dragover.prevent="dragOver($event, index, null)"
                                             @dragleave="dragLeave($event)"
                                             @drop.prevent="drop($event, index, null)"
                                             @dragend="dragEnd()"
                                             tabindex="0"
                                             role="treeitem"
                                             :aria-expanded="node.children?.length ? node.expanded : undefined"
                                             :aria-selected="selectedNode === node.id"
                                             :aria-level="1"
                                             @focus="lastFocusedNode = node.id">
                                            
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <span x-show="node.children && node.children.length > 0" 
                                                          :class="node.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                          @click.stop="toggleNode(node.id)"></span>
                                                    <span x-html="formatNodeText(node)"></span>
                                                    <span class="depth-indicator">Depth: 1</span>
                                                </div>
                                                <div class="flex space-x-1">
                                                    <button @click.stop="editNode(node.id)" class="text-blue-500 hover:text-blue-700">
                                                        Edit
                                                    </button>
                                                    <button @click.stop="deleteNode(node.id)" class="text-red-500 hover:text-red-700">
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Drop indicator below node -->
                                        <template x-if="dropTargetIndex === index && dropTargetParent === null && dropPosition === 'after'">
                                            <div class="drop-indicator"></div>
                                        </template>
                                        
                                        <!-- Children nodes wrapper with key for reactivity -->
                                        <div x-show="node.expanded" class="tree-children" :key="node.id + '-children'">
                                            <!-- Child nodes with their own key for reactivity -->
                                            <template x-for="(childNode, childIndex) in node.children" :key="childNode.id + '-' + childIndex">
                                                <div>
                                                    <!-- Drop indicator above child -->
                                                    <template x-if="dropTargetIndex === childIndex && dropTargetParent === node.id && dropPosition === 'before'">
                                                        <div class="drop-indicator"></div>
                                                    </template>
                                                    
                                                    <!-- Child node with improved reactivity -->
                                                    <div :id="'node-' + childNode.id"
                                                         :class="{
                                                            'tree-node': true,
                                                            'active': selectedNode === childNode.id,
                                                            'search-match': nodeMatchesSearch(childNode),
                                                            'dragover': dropPosition === 'inside' && dropTargetParent === childNode.id,
                                                            'dragover-before': dropPosition === 'before' && dropTargetIndex === childIndex && dropTargetParent === node.id,
                                                            'dragover-after': dropPosition === 'after' && dropTargetIndex === childIndex && dropTargetParent === node.id,
                                                            'beyond-max-depth': !isNodeVisible(childNode)
                                                         }"
                                                         @click.stop="selectNode(childNode.id)"
                                                         draggable="true"
                                                         @dragstart="dragStart($event, childNode.id)"
                                                         @dragover.prevent="dragOver($event, childIndex, node.id)"
                                                         @dragleave="dragLeave($event)"
                                                         @drop.prevent="drop($event, childIndex, node.id)"
                                                         @dragend="dragEnd()"
                                                         tabindex="0"
                                                         role="treeitem"
                                                         @focus="lastFocusedNode = childNode.id">
                                                        
                                                        <div class="flex items-center justify-between">
                                                            <div class="flex items-center">
                                                                <span x-show="childNode.children && childNode.children.length > 0" 
                                                                    :class="childNode.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                    @click.stop="toggleNode(childNode.id)"></span>
                                                                <span x-html="formatNodeText(childNode)"></span>
                                                                <span class="depth-indicator">Depth: 2</span>
                                                            </div>
                                                            <div class="flex space-x-1">
                                                                <button @click.stop="editNode(childNode.id)" class="text-blue-500 hover:text-blue-700">
                                                                    Edit
                                                                </button>
                                                                <button @click.stop="deleteNode(childNode.id)" class="text-red-500 hover:text-red-700">
                                                                    Delete
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Drop indicator below child -->
                                                    <template x-if="dropTargetIndex === childIndex && dropTargetParent === node.id && dropPosition === 'after'">
                                                        <div class="drop-indicator"></div>
                                                    </template>

                                                    <!-- Recursive child nodes (3rd level) -->
                                                    <div x-show="childNode.expanded && childNode.children && childNode.children.length > 0" 
                                                         class="tree-children" 
                                                         :key="childNode.id + '-children'">
                                                        <template x-for="(grandChild, grandChildIndex) in childNode.children" :key="grandChild.id + '-' + grandChildIndex">
                                                            <div>
                                                                <!-- Drop indicators for grandchildren -->
                                                                <template x-if="dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id && dropPosition === 'before'">
                                                                    <div class="drop-indicator"></div>
                                                                </template>
                                                                
                                                                <!-- Grandchild node -->
                                                                <div :id="'node-' + grandChild.id"
                                                                     :class="{
                                                                        'tree-node': true,
                                                                        'active': selectedNode === grandChild.id,
                                                                        'search-match': nodeMatchesSearch(grandChild),
                                                                        'dragover': dropPosition === 'inside' && dropTargetParent === grandChild.id,
                                                                        'dragover-before': dropPosition === 'before' && dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id,
                                                                        'dragover-after': dropPosition === 'after' && dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id,
                                                                        'beyond-max-depth': !isNodeVisible(grandChild)
                                                                     }"
                                                                     @click.stop="selectNode(grandChild.id)"
                                                                     draggable="true"
                                                                     @dragstart="dragStart($event, grandChild.id)"
                                                                     @dragover.prevent="dragOver($event, grandChildIndex, childNode.id)"
                                                                     @dragleave="dragLeave($event)"
                                                                     @drop.prevent="drop($event, grandChildIndex, childNode.id)"
                                                                     @dragend="dragEnd()"
                                                                     tabindex="0">
                                                                    <div class="flex items-center justify-between">
                                                                        <div class="flex items-center">
                                                                            <span x-show="grandChild.children && grandChild.children.length > 0" 
                                                                                :class="grandChild.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                                @click.stop="toggleNode(grandChild.id)"></span>
                                                                            <span x-html="formatNodeText(grandChild)"></span>
                                                                            <span class="depth-indicator">Depth: 3</span>
                                                                        </div>
                                                                        <div class="flex space-x-1">
                                                                            <button @click.stop="editNode(grandChild.id)" class="text-blue-500 hover:text-blue-700">
                                                                                Edit
                                                                            </button>
                                                                            <button @click.stop="deleteNode(grandChild.id)" class="text-red-500 hover:text-red-700">
                                                                                Delete
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Drop indicator below grandchild -->
                                                                <template x-if="dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id && dropPosition === 'after'">
                                                                    <div class="drop-indicator"></div>
                                                                </template>
                                                                
                                                                <!-- 4th level children - with special styling for deeper levels -->
                                                                <div x-show="grandChild.expanded && grandChild.children && grandChild.children.length > 0" 
                                                                    class="tree-children" 
                                                                    :key="grandChild.id + '-children'">
                                                                    <template x-for="(greatGrandChild, greatGrandChildIndex) in grandChild.children" :key="greatGrandChild.id + '-' + greatGrandChildIndex">
                                                                        <div>
                                                                            <!-- Drop indicator -->
                                                                            <template x-if="dropTargetIndex === greatGrandChildIndex && dropTargetParent === grandChild.id && dropPosition === 'before'">
                                                                                <div class="drop-indicator"></div>
                                                                            </template>
                                                                            
                                                                            <!-- Great grandchild node -->
                                                                            <div :id="'node-' + greatGrandChild.id"
                                                                                :class="{
                                                                                    'tree-node': true,
                                                                                    'active': selectedNode === greatGrandChild.id,
                                                                                    'search-match': nodeMatchesSearch(greatGrandChild),
                                                                                    'dragover': dropPosition === 'inside' && dropTargetParent === greatGrandChild.id,
                                                                                    'dragover-before': dropPosition === 'before' && dropTargetIndex === greatGrandChildIndex && dropTargetParent === grandChild.id,
                                                                                    'dragover-after': dropPosition === 'after' && dropTargetIndex === greatGrandChildIndex && dropTargetParent === grandChild.id,
                                                                                    'beyond-max-depth': !isNodeVisible(greatGrandChild)
                                                                                }"
                                                                                @click.stop="selectNode(greatGrandChild.id)"
                                                                                draggable="true"
                                                                                @dragstart="dragStart($event, greatGrandChild.id)"
                                                                                @dragover.prevent="dragOver($event, greatGrandChildIndex, grandChild.id)"
                                                                                @dragleave="dragLeave($event)"
                                                                                @drop.prevent="drop($event, greatGrandChildIndex, grandChild.id)"
                                                                                @dragend="dragEnd()"
                                                                                tabindex="0">
                                                                                <div class="flex items-center justify-between">
                                                                                    <div class="flex items-center">
                                                                                        <span x-show="greatGrandChild.children && greatGrandChild.children.length > 0" 
                                                                                            :class="greatGrandChild.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                                            @click.stop="toggleNode(greatGrandChild.id)"></span>
                                                                                        <span x-html="formatNodeText(greatGrandChild)"></span>
                                                                                        <span class="depth-indicator">Depth: 4</span>
                                                                                    </div>
                                                                                    <div class="flex space-x-1">
                                                                                        <button @click.stop="editNode(greatGrandChild.id)" class="text-blue-500 hover:text-blue-700">
                                                                                            Edit
                                                                                        </button>
                                                                                        <button @click.stop="deleteNode(greatGrandChild.id)" class="text-red-500 hover:text-red-700">
                                                                                            Delete
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            <!-- Drop indicator -->
                                                                            <template x-if="dropTargetIndex === greatGrandChildIndex && dropTargetParent === grandChild.id && dropPosition === 'after'">
                                                                                <div class="drop-indicator"></div>
                                                                            </template>
                                                                            
                                                                            <!-- Deeper levels would continue recursively with shouldRenderNode check -->
                                                                        </div>
                                                                    </template>
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Examples Tabs -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">Interactive Examples</h2>
            
            <!-- Tab Navigation -->
            <div class="flex flex-wrap gap-2 border-b mb-6">
                <button 
                    @click="activeTab = 'basic'" 
                    :class="{ 'bg-blue-500 text-white': activeTab === 'basic', 'bg-gray-100': activeTab !== 'basic' }"
                    class="px-4 py-2 rounded-t-lg">
                    Basic Usage
                </button>
                <button 
                    @click="activeTab = 'advanced'" 
                    :class="{ 'bg-blue-500 text-white': activeTab === 'advanced', 'bg-gray-100': activeTab !== 'advanced' }"
                    class="px-4 py-2 rounded-t-lg">
                    Advanced Configuration
                </button>
                <button 
                    @click="activeTab = 'filesystem'" 
                    :class="{ 'bg-blue-500 text-white': activeTab === 'filesystem', 'bg-gray-100': activeTab !== 'filesystem' }"
                    class="px-4 py-2 rounded-t-lg">
                    File System Example
                </button>
                <button 
                    @click="activeTab = 'organization'" 
                    :class="{ 'bg-blue-500 text-white': activeTab === 'organization', 'bg-gray-100': activeTab !== 'organization' }"
                    class="px-4 py-2 rounded-t-lg">
                    Organization Chart
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-panels">
                <!-- Basic Usage Tab -->
                <div x-show="activeTab === 'basic'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Basic TreeView</h3>
                            <!-- Basic Example -->
                            <div x-data="TreeView({
                                data: [
                                    {
                                        id: 'basic-1',
                                        name: 'Documents',
                                        expanded: true,
                                        children: [
                                            { 
                                                id: 'basic-2', 
                                                name: 'Reports', 
                                                children: [
                                                    { id: 'basic-3', name: 'Annual Report.pdf', children: [] },
                                                    { id: 'basic-4', name: 'Monthly Report.pdf', children: [] }
                                                ]
                                            },
                                            { id: 'basic-5', name: 'Pictures', children: [] }
                                        ]
                                    }
                                ]
                            })">
                                <!-- Tree container -->
                                <div class="min-h-[200px]">
                                    <div class="relative tree-container">
                                        <!-- Root level nodes -->
                                        <template x-for="(node, index) in treeData" :key="node.id">
                                            <div>
                                                <!-- Node -->
                                                <div :id="'node-' + node.id"
                                                     :class="{
                                                        'tree-node': true, 
                                                        'active': selectedNode === node.id
                                                     }"
                                                     @click.stop="selectNode(node.id)">
                                                    
                                                    <div class="flex items-center">
                                                        <span x-show="node.children && node.children.length > 0" 
                                                              :class="node.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                              @click.stop="toggleNode(node.id)"></span>
                                                        <span x-text="node.name"></span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Children nodes -->
                                                <div x-show="node.expanded" class="tree-children">
                                                    <template x-for="(childNode, childIndex) in node.children" :key="childNode.id">
                                                        <div>
                                                            <!-- Child node -->
                                                            <div :id="'node-' + childNode.id"
                                                                 :class="{
                                                                    'tree-node': true,
                                                                    'active': selectedNode === childNode.id
                                                                 }"
                                                                 @click.stop="selectNode(childNode.id)">
                                                                
                                                                <div class="flex items-center">
                                                                    <span x-show="childNode.children && childNode.children.length > 0" 
                                                                          :class="childNode.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                          @click.stop="toggleNode(childNode.id)"></span>
                                                                    <span x-text="childNode.name"></span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Grandchildren -->
                                                            <div x-show="childNode.expanded" class="tree-children">
                                                                <template x-for="grandChild in childNode.children" :key="grandChild.id">
                                                                    <div :id="'node-' + grandChild.id" class="tree-node" @click.stop="selectNode(grandChild.id)">
                                                                        <span x-text="grandChild.name"></span>
                                                                    </div>
                                                                </template>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Implementation Code</h3>
                            <div class="code-block text-sm">
&lt;div x-data="TreeView({
    data: [
        {
            id: 'basic-1',
            name: 'Documents',
            expanded: true,
            children: [
                { 
                    id: 'basic-2', 
                    name: 'Reports', 
                    children: [
                        { id: 'basic-3', name: 'Annual Report.pdf', children: [] },
                        { id: 'basic-4', name: 'Monthly Report.pdf', children: [] }
                    ]
                },
                { id: 'basic-5', name: 'Pictures', children: [] }
            ]
        }
    ]
})">
    <!-- Tree will render here -->
&lt;/div></div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration Tab -->
                <div x-show="activeTab === 'advanced'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Advanced TreeView</h3>
                            <!-- Advanced Example -->
                            <div x-data="TreeView({
                                data: [
                                    {
                                        id: 'adv-1',
                                        name: 'Project Tasks',
                                        expanded: true,
                                        children: [
                                            { 
                                                id: 'adv-2', 
                                                name: 'Phase 1', 
                                                children: [
                                                    { id: 'adv-3', name: 'Research', children: [] },
                                                    { id: 'adv-4', name: 'Design', children: [] }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                maxVisibleDepth: 10,
                                allowDragDrop: true,
                                allowCrossCategory: true,
                                highlightSearch: true,
                                onNodeMove: (node, details) => {
                                    console.log('Node moved:', node, details);
                                },
                                onSearch: (query, results) => {
                                    console.log('Search results:', results);
                                }
                            })">
                                <!-- Add Search -->
                                <div class="search-container mb-4">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" 
                                           x-model="searchQuery" 
                                           placeholder="Search nodes..."
                                           class="search-input focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" />
                                </div>
                                
                                <!-- Tree container -->
                                <div class="min-h-[200px]">
                                    <div class="relative tree-container">
                                        <!-- Root level nodes -->
                                        <template x-for="(node, index) in treeData" :key="node.id">
                                            <div>
                                                <!-- Drop indicator -->
                                                <template x-if="dropTargetIndex === index && dropTargetParent === null && dropPosition === 'before'">
                                                    <div class="drop-indicator"></div>
                                                </template>
                                                
                                                <!-- Node -->
                                                <div :id="'node-' + node.id"
                                                     :class="{
                                                        'tree-node': true, 
                                                        'active': selectedNode === node.id,
                                                        'search-match': nodeMatchesSearch(node),
                                                        'dragover': dropPosition === 'inside' && dropTargetParent === node.id,
                                                        'dragover-before': dropPosition === 'before' && dropTargetIndex === index && dropTargetParent === null,
                                                        'dragover-after': dropPosition === 'after' && dropTargetIndex === index && dropTargetParent === null
                                                     }"
                                                     @click.stop="selectNode(node.id)"
                                                     draggable="true"
                                                     @dragstart="dragStart($event, node.id)"
                                                     @dragover.prevent="dragOver($event, index, null)"
                                                     @dragleave="dragLeave($event)"
                                                     @drop.prevent="drop($event, index, null)"
                                                     @dragend="dragEnd()">
                                                    
                                                    <div class="flex items-center justify-between">
                                                        <div class="flex items-center">
                                                            <span x-show="node.children && node.children.length > 0" 
                                                                  :class="node.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                  @click.stop="toggleNode(node.id)"></span>
                                                            <span x-html="formatNodeText(node)"></span>
                                                        </div>
                                                        <div class="flex space-x-1">
                                                            <button @click.stop="editNode(node.id)" class="text-blue-500 hover:text-blue-700">
                                                                Edit
                                                            </button>
                                                            <button @click.stop="deleteNode(node.id)" class="text-red-500 hover:text-red-700">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Drop indicator -->
                                                <template x-if="dropTargetIndex === index && dropTargetParent === null && dropPosition === 'after'">
                                                    <div class="drop-indicator"></div>
                                                </template>
                                                
                                                <!-- Children nodes -->
                                                <div x-show="node.expanded" class="tree-children">
                                                    <template x-for="(childNode, childIndex) in node.children" :key="childNode.id">
                                                        <div>
                                                            <!-- Drop indicator -->
                                                            <template x-if="dropTargetIndex === childIndex && dropTargetParent === node.id && dropPosition === 'before'">
                                                                <div class="drop-indicator"></div>
                                                            </template>
                                                            
                                                            <!-- Child node -->
                                                            <div :id="'node-' + childNode.id"
                                                                 :class="{
                                                                    'tree-node': true, 
                                                                    'active': selectedNode === childNode.id,
                                                                    'search-match': nodeMatchesSearch(childNode),
                                                                    'dragover': dropPosition === 'inside' && dropTargetParent === childNode.id,
                                                                    'dragover-before': dropPosition === 'before' && dropTargetIndex === childIndex && dropTargetParent === node.id,
                                                                    'dragover-after': dropPosition === 'after' && dropTargetIndex === childIndex && dropTargetParent === node.id
                                                                 }"
                                                                 @click.stop="selectNode(childNode.id)"
                                                                 draggable="true"
                                                                 @dragstart="dragStart($event, childNode.id)"
                                                                 @dragover.prevent="dragOver($event, childIndex, node.id)"
                                                                 @dragleave="dragLeave($event)"
                                                                 @drop.prevent="drop($event, childIndex, node.id)"
                                                                 @dragend="dragEnd()">
                                                                
                                                                <div class="flex items-center">
                                                                    <span x-show="childNode.children && childNode.children.length > 0" 
                                                                          :class="childNode.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                          @click.stop="toggleNode(childNode.id)"></span>
                                                                    <span x-html="formatNodeText(childNode)"></span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Drop indicator -->
                                                            <template x-if="dropTargetIndex === childIndex && dropTargetParent === node.id && dropPosition === 'after'">
                                                                <div class="drop-indicator"></div>
                                                            </template>
                                                            
                                                            <!-- Grandchildren -->
                                                            <div x-show="childNode.expanded" class="tree-children">
                                                                <template x-for="(grandChild, grandChildIndex) in childNode.children" :key="grandChild.id">
                                                                    <div>
                                                                        <!-- Drop indicator -->
                                                                        <template x-if="dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id && dropPosition === 'before'">
                                                                            <div class="drop-indicator"></div>
                                                                        </template>
                                                                        
                                                                        <!-- Grandchild node -->
                                                                        <div :id="'node-' + grandChild.id"
                                                                             :class="{
                                                                                'tree-node': true, 
                                                                                'active': selectedNode === grandChild.id,
                                                                                'search-match': nodeMatchesSearch(grandChild),
                                                                                'dragover': dropPosition === 'inside' && dropTargetParent === grandChild.id,
                                                                                'dragover-before': dropPosition === 'before' && dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id,
                                                                                'dragover-after': dropPosition === 'after' && dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id
                                                                             }"
                                                                             @click.stop="selectNode(grandChild.id)"
                                                                             draggable="true"
                                                                             @dragstart="dragStart($event, grandChild.id)"
                                                                             @dragover.prevent="dragOver($event, grandChildIndex, childNode.id)"
                                                                             @dragleave="dragLeave($event)"
                                                                             @drop.prevent="drop($event, grandChildIndex, childNode.id)"
                                                                             @dragend="dragEnd()">
                                                                            <span x-html="formatNodeText(grandChild)"></span>
                                                                        </div>
                                                                        
                                                                        <!-- Drop indicator -->
                                                                        <template x-if="dropTargetIndex === grandChildIndex && dropTargetParent === childNode.id && dropPosition === 'after'">
                                                                            <div class="drop-indicator"></div>
                                                                        </template>
                                                                    </div>
                                                                </template>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <div class="mt-4 flex space-x-2">
                                    <button @click="expandAll()" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                                        Expand All
                                    </button>
                                    <button @click="collapseAll()" class="px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">
                                        Collapse All
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Advanced Configuration</h3>
                            <div class="code-block text-sm">
&lt;div x-data="TreeView({
    data: [...],
    maxVisibleDepth: 3,
    allowDragDrop: true,
    allowCrossCategory: true,
    highlightSearch: true,
    onNodeMove: (node, details) => {
        console.log('Node moved:', node, details);
    },
    onSearch: (query, results) => {
        console.log('Search results:', results);
    }
})">
    <!-- Tree will render here -->
&lt;/div></div>
                        </div>
                    </div>
                </div>

                <!-- File System Example Tab -->
                <div x-show="activeTab === 'filesystem'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">File System TreeView</h3>
                            <!-- File System Example -->
                            <div x-data="TreeView({
                                data: [
                                    {
                                        id: 'fs-1',
                                        name: 'project/',
                                        expanded: true,
                                        children: [
                                            { 
                                                id: 'fs-2', 
                                                name: 'src/', 
                                                expanded: true,
                                                children: [
                                                    { id: 'fs-3', name: 'index.js', children: [] },
                                                    { id: 'fs-4', name: 'components/', children: [
                                                        { id: 'fs-5', name: 'App.js', children: [] },
                                                        { id: 'fs-6', name: 'Header.js', children: [] }
                                                    ] }
                                                ]
                                            },
                                            { 
                                                id: 'fs-7', 
                                                name: 'public/', 
                                                children: [
                                                    { id: 'fs-8', name: 'index.html', children: [] },
                                                    { id: 'fs-9', name: 'styles.css', children: [] }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                maxVisibleDepth: 10
                            })">
                                <!-- Tree container -->
                                <div class="min-h-[200px]">
                                    <div class="relative tree-container">
                                        <!-- Root level nodes -->
                                        <template x-for="(node, index) in treeData" :key="node.id">
                                            <div>
                                                <!-- Node -->
                                                <div :id="'node-' + node.id"
                                                     :class="{ 'tree-node': true, 'active': selectedNode === node.id }"
                                                     @click.stop="selectNode(node.id)">
                                                    
                                                    <div class="flex items-center">
                                                        <span x-show="node.children && node.children.length > 0" 
                                                              :class="node.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                              @click.stop="toggleNode(node.id)"></span>
                                                        <span x-text="node.name"></span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Children nodes -->
                                                <div x-show="node.expanded" class="tree-children">
                                                    <template x-for="childNode in node.children" :key="childNode.id">
                                                        <div>
                                                            <!-- Child node -->
                                                            <div :id="'node-' + childNode.id"
                                                                 :class="{ 'tree-node': true, 'active': selectedNode === childNode.id }"
                                                                 @click.stop="selectNode(childNode.id)">
                                                                
                                                                <div class="flex items-center">
                                                                    <span x-show="childNode.children && childNode.children.length > 0" 
                                                                          :class="childNode.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                          @click.stop="toggleNode(childNode.id)"></span>
                                                                    <span x-text="childNode.name"></span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Grandchildren -->
                                                            <div x-show="childNode.expanded" class="tree-children">
                                                                <template x-for="grandChild in childNode.children" :key="grandChild.id">
                                                                    <div :id="'node-' + grandChild.id" class="tree-node" @click.stop="selectNode(grandChild.id)">
                                                                        <span x-text="grandChild.name"></span>
                                                                    </div>
                                                                </template>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">File System Implementation</h3>
                            <div class="code-block text-sm">
&lt;div x-data="TreeView({
    data: [
        {
            id: 'fs-1',
            name: 'project/',
            expanded: true,
            children: [
                { 
                    id: 'fs-2', 
                    name: 'src/', 
                    expanded: true,
                    children: [
                        { id: 'fs-3', name: 'index.js', children: [] },
                        { id: 'fs-4', name: 'components/', children: [
                            { id: 'fs-5', name: 'App.js', children: [] },
                            { id: 'fs-6', name: 'Header.js', children: [] }
                        ] }
                    ]
                },
                // ... more files and folders
            ]
        }
    ],
    maxVisibleDepth: 4
})">
    <!-- Tree will render here -->
&lt;/div></div>
                        </div>
                    </div>
                </div>

                <!-- Organization Chart Tab -->
                <div x-show="activeTab === 'organization'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Organization Chart</h3>
                            <!-- Organization Example -->
                            <div x-data="TreeView({
                                data: [
                                    {
                                        id: 'org-1',
                                        name: 'CEO',
                                        expanded: true,
                                        children: [
                                            { 
                                                id: 'org-2', 
                                                name: 'CTO', 
                                                expanded: true,
                                                children: [
                                                    { 
                                                        id: 'org-3', 
                                                        name: 'Engineering Manager',
                                                        children: [
                                                            { id: 'org-4', name: 'Senior Developer', children: [] },
                                                            { id: 'org-5', name: 'Junior Developer', children: [] }
                                                        ] 
                                                    },
                                                    { id: 'org-6', name: 'QA Manager', children: [] }
                                                ]
                                            },
                                            { 
                                                id: 'org-7', 
                                                name: 'CFO', 
                                                children: [
                                                    { id: 'org-8', name: 'Finance Manager', children: [] },
                                                    { id: 'org-9', name: 'Accountant', children: [] }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                maxVisibleDepth: 10,
                                allowDragDrop: true
                            })">
                                <!-- Tree container -->
                                <div class="min-h-[200px]">
                                    <div class="relative tree-container">
                                        <!-- Root level nodes -->
                                        <template x-for="(node, index) in treeData" :key="node.id">
                                            <div>
                                                <!-- Node -->
                                                <div :id="'node-' + node.id"
                                                     :class="{ 'tree-node': true, 'active': selectedNode === node.id }"
                                                     @click.stop="selectNode(node.id)">
                                                    
                                                    <div class="flex items-center">
                                                        <span x-show="node.children && node.children.length > 0" 
                                                              :class="node.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                              @click.stop="toggleNode(node.id)"></span>
                                                        <span x-text="node.name"></span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Children nodes -->
                                                <div x-show="node.expanded" class="tree-children">
                                                    <template x-for="childNode in node.children" :key="childNode.id">
                                                        <div>
                                                            <!-- Child node -->
                                                            <div :id="'node-' + childNode.id"
                                                                 :class="{ 'tree-node': true, 'active': selectedNode === childNode.id }"
                                                                 @click.stop="selectNode(childNode.id)">
                                                                
                                                                <div class="flex items-center">
                                                                    <span x-show="childNode.children && childNode.children.length > 0" 
                                                                          :class="childNode.expanded ? 'expanded-indicator' : 'collapsed-indicator'"
                                                                          @click.stop="toggleNode(childNode.id)"></span>
                                                                    <span x-text="childNode.name"></span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Grandchildren -->
                                                            <div x-show="childNode.expanded" class="tree-children">
                                                                <template x-for="grandChild in childNode.children" :key="grandChild.id">
                                                                    <div :id="'node-' + grandChild.id" class="tree-node" @click.stop="selectNode(grandChild.id)">
                                                                        <span x-text="grandChild.name"></span>
                                                                    </div>
                                                                </template>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Organization Chart Implementation</h3>
                            <div class="code-block text-sm">
&lt;div x-data="TreeView({
    data: [
        {
            id: 'org-1',
            name: 'CEO',
            expanded: true,
            children: [
                { 
                    id: 'org-2', 
                    name: 'CTO', 
                    expanded: true,
                    children: [
                        { 
                            id: 'org-3', 
                            name: 'Engineering Manager',
                            children: [
                                { id: 'org-4', name: 'Senior Developer', children: [] },
                                { id: 'org-5', name: 'Junior Developer', children: [] }
                            ] 
                        },
                        // ... more positions
                    ]
                },
                // ... more departments
            ]
        }
    ],
    maxVisibleDepth: 4,
    allowDragDrop: true
})">
    <!-- Tree will render here -->
&lt;/div></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- API Documentation -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">API Documentation</h2>
            
            <div class="space-y-6">
                <!-- Configuration Options -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Configuration Options</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left border">Option</th>
                                    <th class="px-4 py-2 text-left border">Type</th>
                                    <th class="px-4 py-2 text-left border">Default</th>
                                    <th class="px-4 py-2 text-left border">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">data</td>
                                    <td class="px-4 py-2 border">Array</td>
                                    <td class="px-4 py-2 border">[]</td>
                                    <td class="px-4 py-2 border">Tree data structure</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">maxVisibleDepth</td>
                                    <td class="px-4 py-2 border">Number</td>
                                    <td class="px-4 py-2 border">4</td>
                                    <td class="px-4 py-2 border">Maximum visible nesting depth</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">allowDragDrop</td>
                                    <td class="px-4 py-2 border">Boolean</td>
                                    <td class="px-4 py-2 border">true</td>
                                    <td class="px-4 py-2 border">Enable drag and drop</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">allowCrossCategory</td>
                                    <td class="px-4 py-2 border">Boolean</td>
                                    <td class="px-4 py-2 border">true</td>
                                    <td class="px-4 py-2 border">Allow moving nodes between categories</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">highlightSearch</td>
                                    <td class="px-4 py-2 border">Boolean</td>
                                    <td class="px-4 py-2 border">true</td>
                                    <td class="px-4 py-2 border">Highlight search matches</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Events -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Events</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left border">Event</th>
                                    <th class="px-4 py-2 text-left border">Parameters</th>
                                    <th class="px-4 py-2 text-left border">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">onNodeMove</td>
                                    <td class="px-4 py-2 border">(node, details)</td>
                                    <td class="px-4 py-2 border">Called when a node is moved</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">onNodeSelect</td>
                                    <td class="px-4 py-2 border">(node)</td>
                                    <td class="px-4 py-2 border">Called when a node is selected</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">onSearch</td>
                                    <td class="px-4 py-2 border">(query, results)</td>
                                    <td class="px-4 py-2 border">Called when search is performed</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Methods -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Public Methods</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left border">Method</th>
                                    <th class="px-4 py-2 text-left border">Parameters</th>
                                    <th class="px-4 py-2 text-left border">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">expandAll()</td>
                                    <td class="px-4 py-2 border">-</td>
                                    <td class="px-4 py-2 border">Expands all nodes</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">collapseAll()</td>
                                    <td class="px-4 py-2 border">-</td>
                                    <td class="px-4 py-2 border">Collapses all nodes</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">getData()</td>
                                    <td class="px-4 py-2 border">-</td>
                                    <td class="px-4 py-2 border">Returns current tree data</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 border font-mono">setData(data)</td>
                                    <td class="px-4 py-2 border">Array</td>
                                    <td class="px-4 py-2 border">Updates tree data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center py-8 text-gray-600">
            <p>TreeView Component v1.0.7 - Built with Alpine.js</p>
        </footer>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            // Event listeners for demonstration
            ['treeview:node-moved', 'treeview:node-selected', 'treeview:searched'].forEach(event => {
                document.addEventListener(event, (e) => {
                    console.log(`${event}:`, e.detail);
                });
            });

            // Add event listener for node-moved to force redraw and update visibility
            document.addEventListener('treeview:node-moved', (e) => {
                // This ensures the UI updates properly after drag operations
                setTimeout(() => {
                    const treeContainers = document.querySelectorAll('.tree-container');
                    treeContainers.forEach(container => {
                        const component = Alpine.$data(container.closest('[x-data]'));
                        if (component) {
                            // Update visibility attributes
                            component.updateNodeVisibility();
                            // Force DOM update without deep cloning
                            component.treeData = [...component.treeData];
                        }
                    });
                }, 10);
            });

            // Add event listener for node-added to force redraw
            document.addEventListener('treeview:node-added', (e) => {
                // Ensure the UI updates after adding a node
                setTimeout(() => {
                    const treeContainers = document.querySelectorAll('.tree-container');
                    treeContainers.forEach(container => {
                        const component = Alpine.$data(container.closest('[x-data]'));
                        if (component) {
                            // Update visibility attributes
                            component.updateNodeVisibility();
                            component.treeData = [...component.treeData];
                        }
                    });
                }, 10);
            });
        });
    </script>
</body>
</html>
